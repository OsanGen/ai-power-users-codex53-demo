Render Component

Purpose:
- Draw all visuals each frame from `AIPU.state`, including environment, entities, HUD, state overlays, and visual theme layers.
- Apply the arena floor visual themes and transition overlays while keeping gameplay state and rules unchanged.
- Add optional, modularized, render-only FX feedback (camera, bullets, particles, distortion) driven by `fxState` and `FX_CONFIG`.

Inputs:
- Render state (`AIPU.state.game`, `AIPU.state.player`, entity collections).
- Constants and helpers from `AIPU.constants` and `AIPU.utils`.
- Narrative content helpers from `AIPU.content` for all overlay labels.
- Optional systems callbacks from `AIPU.systems` for collections and state transitions.

Outputs:
- A single frame on `canvas`.
- Overlay content for title, upgrade cards, bomb briefing, lesson/death lesson, floor intro/clear, and run summary.
- Background and world layers with per-floor visual theme data.

State/Edges:
- Uses `ctx.textAlign`/`textBaseline` state carefully and resets at block exits.
- Uses `withRectClip` for lesson/death text clipping and `withClipRect` for rounded-panel masking.
- Keeps overlay text readable by top-aligned clipping paths with insets.
- Supports reduced-motion by removing motion terms.
- Adds optional background strip-warp distortion in `updateDynamicLayer()` after base corridor draw.
  - Distortion is world-only (`WORLD` clip), low tier disabled/near-flat.
  - Uses per-floor strip orientation and sinusoidal offsets from `fxState.intensity` + `visualTheme.trippyLevel`.
  - Enforces center fade and quality-based max amplitude bounds.
- Adds `getDynamicEscalation(progress)` to derive composed pressure from normalized floor progress and active threat.
  - Dynamic floor motifs (`drawFloorDynamicIdentityByPack`) receive floor progress and scale density/motion using `easeInOutSine` and `easeOutCubic`.
  - `edgeBlend(...)` applies stronger modulation toward WORLD edges so center stays clearer under escalation.
- Reduced-motion support is centralized:
  - `isFxToggleEnabled` disables `trails`, `chroma`, and `grain` when `AIPU.input.prefersReducedMotion` is true.
  - `applyStripWarpDistortion()` caps distortion at ≤1px and scales distortion frequency.
  - Camera and background motion uses a dedicated reduced-motion background scale to keep shake/zoom and floor parallax in the 60–80% reduction band.
  - Lesson/title/death overlays skip or zero out motion terms when reduced-motion is enabled.
- "No hard-flash" check in visual FX paths:
  - avoid full-intensity abrupt color toggles on reduced-motion states;
  - keep chroma/reduce-motion effects below noticeable flash thresholds by clamping alpha and preserving WORLD clipping.
- Added optional high-tier chroma edge split in `applyChromaEdgeSplit()`.
  - Runs only when `FX_CONFIG.quality === "high"` and `FX_CONFIG.toggles.chroma` is true.
  - Draws a clipped 14px WORLD border band with ±1px edge offsets in one support color at low alpha.
  - Guarded to remain subtle and non-glowy (`edgeAlpha <= 0.02` effective per pass).
- Added `FLOOR_FX_PACKS` visual identity matrix (`1..15`) with lead, distortion mode, motif, parallax, lattice metadata.
- `hasDynamicFloorVisuals()` is now 1..15 and floor skins are now driven by pack selection for static + dynamic layers.
  - Floors `1..9` render enriched layered motifs; floors `10..13` add dedicated late-game overlays for stronger movement. Floors `14..15` remain no-op placeholders.
- Added dedicated late-floor static and dynamic post-nine overlay helpers so `10..13` keep visible motion pressure through edge-driven and escalated animated motifs.
- Maintains one-accent rendering by keeping support colors secondary and low-alpha only.
- No gameplay mechanics are changed in render path.
- `hasDynamicFloorVisuals` now safely accepts numeric or numeric-string floor IDs before enabling dynamic layer effects.
- Added a GLFX wrapper post-process on the world layer using `glfx.js` in `applyGlfxWorldPass()`.
  - Initializes WebGL pipeline via `initGlfxWorldFx()` / `tryCreateGlfxWorldFx()` only in render namespace.
  - Uses a cached `fxCanvas` and `sourceCanvas` to keep GLFX updates in world-space only (WORLD clip).
  - Builds tiered filter chains via `applyGlfxPassForTier()`:
    - low: subtle `bulgePinch`
    - medium: `bulgePinch + swirl`
    - high: adds muted `swirl + noise + vignette`
  - Honors reduced-motion by scaling effect down aggressively and avoiding abrupt color-heavy operations.
  - Catches runtime exceptions and falls back to existing native distortions when GLFX fails.
  - Invoked from `draw()` after world rendering and world-camera restore, before HUD and state overlay draws.
- GLFX status/error state is tracked in-process (`ready`, `applied`, `fallback`, `error`, `disabled`, `idle`), with debug surfacing in `drawDebugStatsLine`.
- Added world-layer-only character head variant in `drawPlayer()`:
  - Head now renders as a rotating cog motif with subtle per-frame color shift using floor support/accent mix.
  - Keeps lead accent dominance and avoids gameplay state changes.

Dependencies:
- `AIPU.content` narrative helper methods for labels.
- `AIPU.systems` collections and state helpers.
- `AIPU.utils` for color/geometry/font helpers.

Acceptance Checks:
- No state transitions altered by rendering.
- Lesson/death overlays remain legible with stable baseline/clipping.
- Floor themes resolve consistently by floor id.
- Prompt 12 Performance + debug
  - `drawDebugStatsLine` shows render-only FX diagnostics when `game.showDebugStats` is active.
  - Diagnostic text reports FX tier (`FX_CONFIG.quality`), particle count, and render cache hit/miss counters.
  - Removed hot-path `Set` allocations by reusing render-local sets in `updateFxState` and `pruneBulletTrails`.
- UI overlays honor current floor count:
  - `drawStateOverlay` clear-state footer only shows "Transitioning..." when floor id is below `FLOORS.length`.
- Run summary pill labels and spacing remain correctly anchored within the summary panel bounds.
- Prompt 6 impact effects implemented:
  - Render-only `fxParticles` array has object pool backed storage and cap by quality tier.
  - Hit events trigger pooled micro sparks near enemy impact points.
  - Death events trigger a ring dissolve and shard-like particles.
  - Update/draw pass runs with line/rect drawing in the world transform and does not mutate gameplay collections.
