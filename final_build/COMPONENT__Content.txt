Content Component

Purpose:
- Centralize all narrative and UI fallback copy used by title, floor overlays, lesson cards, death lessons, HUD labels, and share text.
- Gate gameplay-facing copy through `pickNarrativeText`, defaulting safely when narrative is unavailable.
- Provide content helpers for upgrades, floor wave definitions, enemy lore, and narrative-aware overlays.
- Add late-game pressure layers via extended `ENEMY_DEFS` entries on floors 12–15.

Inputs:
- `window.AI_POWER_USER_NARRATIVE` (optional) as the canonical copy source.
- Runtime state in `AIPU.state` and `AIPU.upgrades` for dynamic copy composition.
- Upgrade and narrative helpers from callers in `systems.js` and `render.js`.
- Floor progression identifiers (`FLOORS`, `floor.id`) for song/visual resolution contracts.

Outputs:
- Helper APIs on `AIPU.content`:
  - `getNarrativeTeachCard(floorId)`
  - `getDeathLessonCard(floorId, seed)`
  - `getNarrativeTitleCard()`
  - `getNarrativeFloorCopy(floor)`
  - `getNarrativeOutcomeCopy(isVictory)`
- `getNarrativeUiText(key, fallback)`
- `getSongPathForFloor(floorIdOrLabel)`
- `getSongPathCandidatesForFloor(floorIdOrLabel)`
- `getBombBriefingCopy(mode)`
- `getWhatYouLearnedBullets()`
- Content constants (`FLOORS`, `TITLE_SEQUENCE`, `ENEMY_DEFS`, etc.)

State/Edges:
- Fallbacks are narrative-aligned and safe when `N` is missing.
- Lesson text editing values are normalized before storage and truncated to `LESSON_TEXT_MAX_CHARS`.
- Floor signatures and threat lore are exposed without mutating gameplay constants.
- `getWhatYouLearnedBullets()` deduplicates upgrade-derived lesson concepts and pads with generic fallback lines.
- Floor IDs resolve to song paths via `getSongPathForFloor`/`getSongPathCandidatesForFloor` using canonical `SONGS/LEVEL_ <n>_15.wav` then compact `LEVEL_<n>_15.wav` variant.
- Floors 10–15 now scale with increasing overlap and introduce two new archetypes (`drift_hound`, `arc_turret`) from floor 12 onward.
- Difficulty progression for floors 10–15 is content-tuned so a simple spawn/speed-weighted pressure metric increases each floor with the late-floor archetype waves.
- Floors 2+ receive an injected dual-homing threat wave via `installDualEnemyWaves()` so the `dual` enemy appears frequently from Floor 2 onward.
- Floors 2+ now receive two injected dual waves per floor (early and mid-late pressure windows) with floor-scaled frequency and speed multipliers to keep homing pressure visually and behaviorally frequent.

Dependencies:
- `AIPU.utils.clamp`
- `AIPU.state` for upgrade history.
- Narrative object in `window.AI_POWER_USER_NARRATIVE`.

Acceptance Checks:
- Nonexistent narrative fields never crash UI (fallbacks always return strings/arrays).
- Floor, lesson, and death overlays receive consistent narrative data even when upgrades have duplicates.
- Share/build card paths are unaffected by copy changes.
- Floor catalog includes 1..15 and new entries parse with valid wave enemy IDs.
- Teach card table includes one entry per floor for 1..15 and supports fallbacks for missing visuals.
- Song resolution returns candidate paths for valid floor IDs and uses final-floor fallback when floor IDs are invalid.
- New enemy archetypes are safe: `drift_hound` uses existing `phase` movement and `arc_turret` uses existing `ranged` behavior.
- Floor 10–15 metrics are kept constrained by wave duration and tuned for staircase pressure from 10→15.
- Dual enemy injection schedules are de-duplicated by `enemyType === "dual"` and should produce active dual waves on all floors 2..15 without floor 1 impact.
- Dual wave windows are intentionally staggered by floor phase to increase pressure retention while preserving spawn cadence balance for other archetypes.
